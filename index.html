<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Happy Bestfriend Day ðŸ’–</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
      font-family: 'Poppins', sans-serif;
      position: relative;
    }
    /* Normal blur background photo */
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: url('v5.jpg') no-repeat center center/cover;
      filter: blur(8px);
      z-index: 0;
    }
    .album-container {
      perspective: 2000px;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;  /* important to stay above blurred bg */
      z-index: 1;
    }
    .book {
      width: 60vw;
      height: 80vh;
      max-width: 400px;
      max-height: 600px;
      position: relative;
      transform-style: preserve-3d;
      z-index: 2;
    }
    .page {
      width: 100%;
      height: 100%;
      position: absolute;
      background-color: #fff;
      background-size: cover;
      background-position: center;
      box-shadow: 0 0 20px rgba(135, 206, 235, 0.5);
      transition: transform 1s ease;
      transform-origin: left center;
      cursor: pointer;
      border-radius: 15px;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: black;
      font-family: 'Great Vibes', cursive;
      font-size: 2em;
      text-align: center;
      padding: 20px;
      user-select: none;
    }
    .page:nth-child(even) {
      z-index: 10;
    }
    .page.flipped {
      transform: rotateY(-180deg);
      z-index: 1 !important;
    }
    /* Caption text fade-in */
    .caption {
      margin-top: auto;
      background: rgba(255, 255, 255, 0.7);
      padding: 10px 15px;
      border-radius: 12px;
      opacity: 0;
      animation: fadeInText 2s forwards 0.5s;
      width: 90%;
      font-size: 1.2em;
      color: #333;
      text-shadow: 0 0 5px #fff;
    }
    @keyframes fadeInText {
      to { opacity: 1; }
    }
    .title {
      color: black;
      -webkit-text-stroke: 1px white;
      text-stroke: 1px white;
      text-shadow: none;
      position: absolute;
      top: 20px;
      width: 100%;
      text-align: center;
      font-family: 'Great Vibes', cursive;
      font-size: 2.5em;
      z-index: 20;
      user-select: none;
    }
    .wish {
      color: black;
      -webkit-text-stroke: 1px white;
      text-stroke: 1px white;
      text-shadow: none;
      position: absolute;
      top: 80px;
      width: 100%;
      text-align: center;
      font-size: 1em;
      z-index: 20;
      padding: 0 10px;
      line-height: 1.5em;
      user-select: none;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 15px;
    }
    audio {
      position: fixed;
      bottom: 15px;
      left: 15px;
      z-index: 999;
    }
    .balloon {
      position: absolute;
      bottom: -100px;
      width: 50px;
      height: 70px;
      background: red;
      border-radius: 50%;
      animation: floatUp 12s linear infinite;
      cursor: pointer;
      z-index: 999;
      user-select: none;
    }
    .balloon::before {
      content: '';
      position: absolute;
      bottom: -20px;
      left: 50%;
      width: 2px;
      height: 20px;
      background: white;
      transform: translateX(-50%);
    }
    @keyframes floatUp {
      0% {
        bottom: -100px;
        opacity: 0;
        transform: translateX(0);
      }
      10% {
        opacity: 1;
      }
      100% {
        bottom: 110vh;
        opacity: 0;
        transform: translateX(-50px);
      }
    }
    .pop {
      animation: pop 0.3s ease forwards;
    }
    @keyframes pop {
      to {
        transform: scale(0);
        opacity: 0;
      }
    }
    @media (max-width: 768px) {
      .title {
        font-size: 2em;
      }
      .wish {
        font-size: 0.9em;
        top: 70px;
      }
      .book {
        width: 80vw;
        height: 90vh;
        max-width: none;
        max-height: none;
      }
      .caption {
        font-size: 1em;
      }
    }
    /* Fireworks overlay */
    #fireworksCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 1000;
      display: none;
    }
    #finalWish {
      color: black;
      -webkit-text-stroke: 1px white;
      text-stroke: 1px white;
      text-shadow: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Great Vibes', cursive;
      font-size: 3em;
      text-align: center;
      z-index: 1100;
      display: none;
      padding: 0 20px;
      max-width: 90vw;
      line-height: 1.2em;
      white-space: pre-line;
      user-select: none;
    }
  </style>
</head>
<body>

  <div class="title">Happy Bestfriend Day ðŸ’–</div>
  <div class="wish">Happy Bestfriend Day To VaishnaviðŸ’–</div>

  <div class="album-container">
    <div class="book" id="book">
      <!-- 10 Image Pages with captions -->
      <div class="page" style="background-image: url('v1.jpg');">
        <div class="caption">Our first memory together â€” unforgettable!</div>
      </div>
      <div class="page" style="background-image: url('v2.jpg');">
        <div class="caption">Laughing till our stomachs hurt.</div>
      </div>
      <div class="page" style="background-image: url('v3.jpg');">
        <div class="caption">Adventures that made us stronger.</div>
      </div>
      <div class="page" style="background-image: url('v4.jpg');">
        <div class="caption">Late night talks and endless dreams.</div>
      </div>
      <div class="page" style="background-image: url('v5.jpg');">
        <div class="caption">The magic of our friendship.</div>
      </div>
      <div class="page" style="background-image: url('v6.jpg');">
        <div class="caption">Every moment cherished forever.</div>
      </div>
      <div class="page" style="background-image: url('v7.jpg');">
        <div class="caption">You make life so beautiful.</div>
      </div>
      <div class="page" style="background-image: url('v8.jpg');">
        <div class="caption">Together through thick and thin.</div>
      </div>
      <div class="page" style="background-image: url('v9.jpg');">
        <div class="caption">Hereâ€™s to many more memories.</div>
      </div>
      <div class="page" style="background-image: url('v10.jpg');">
        <div class="caption">Love you always, bestfriend! ðŸ’–</div>
      </div>
    </div>
  </div>

  <!-- Music -->
  <audio id="bgMusic" loop>
    <source src="song.mp3" type="audio/mp3" />
    Your browser does not support the audio element.
  </audio>

  <!-- Fireworks Canvas -->
  <canvas id="fireworksCanvas"></canvas>

  <!-- Final Wish -->
  <div id="finalWish">To Vaishnavi, my beautiful bestfriend â€”<br>Thank you for being my magic and my heart. Love you always! ðŸ’–ðŸŽ†</div>

  <script>
    // Play background music after first click (user gesture)
    const bgMusic = document.getElementById('bgMusic');
    document.addEventListener('click', function playOnce() {
      bgMusic.play().catch(e => console.log('Autoplay blocked'));
      document.removeEventListener('click', playOnce);
    });

    // Page flip logic
    const pages = document.querySelectorAll(".page");
    let flippedCount = 0;

    pages.forEach((page) => {
      page.addEventListener("click", () => {
        if (page.classList.contains("flipped")) {
          page.classList.remove("flipped");
          flippedCount--;
        } else {
          page.classList.add("flipped");
          flippedCount++;
        }
        checkAllFlipped();
      });
    });

    // Check if all pages flipped
    function checkAllFlipped() {
      if (flippedCount === pages.length) {
        showFireworks();
      } else {
        hideFireworks();
      }
    }

    // Balloon creation and animation
    function createBalloon() {
      const balloon = document.createElement('div');
      const colors = ['#ff4e50', '#ff6ec7', '#ffd166', '#ff6699', '#e60073'];
      balloon.className = 'balloon';
      balloon.style.left = Math.random() * 90 + 'vw';
      balloon.style.background = colors[Math.floor(Math.random() * colors.length)];
      balloon.style.animationDuration = (8 + Math.random() * 5) + 's';

      balloon.onclick = () => {
        balloon.classList.add('pop');
        setTimeout(() => balloon.remove(), 300);
      };

      document.body.appendChild(balloon);
      setTimeout(() => balloon.remove(), 14000);
    }
    setInterval(createBalloon, 900);

    // Fireworks setup
    const canvas = document.getElementById('fireworksCanvas');
    const ctx = canvas.getContext('2d');
    let cw, ch;

    function resize() {
      cw = canvas.width = window.innerWidth;
      ch = canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    class Firework {
      constructor(sx, sy, tx, ty) {
        this.x = sx;
        this.y = sy;
        this.sx = sx;
        this.sy = sy;
        this.tx = tx;
        this.ty = ty;
        this.distanceToTarget = this.calcDistance(sx, sy, tx, ty);
        this.distanceTraveled = 0;
        this.coordinates = [];
        this.coordinateCount = 3;
        while(this.coordinateCount--) {
          this.coordinates.push([this.x, this.y]);
        }
        this.angle = Math.atan2(ty - sy, tx - sx);
        this.speed = 5;
        this.acceleration = 1.05;
        this.brightness = Math.random() * 50 + 50;
        this.targetRadius = 1;
      }
      calcDistance(a, b, c, d) {
        const dx = c - a;
        const dy = d - b;
        return Math.sqrt(dx * dx + dy * dy);
      }
      update(index, fireworks) {
        this.coordinates.pop();
        this.coordinates.unshift([this.x, this.y]);
        if(this.targetRadius < 8) {
          this.targetRadius += 0.3;
        } else {
          this.targetRadius = 1;
        }
        this.speed *= this.acceleration;
        const vx = Math.cos(this.angle) * this.speed;
        const vy = Math.sin(this.angle) * this.speed;
        this.distanceTraveled = this.calcDistance(this.sx, this.sy, this.x + vx, this.y + vy);
        if(this.distanceTraveled >= this.distanceToTarget) {
          createParticles(this.tx, this.ty);
          fireworks.splice(index, 1);
        } else {
          this.x += vx;
          this.y += vy;
        }
      }
      draw() {
        ctx.beginPath();
        ctx.moveTo(this.coordinates[this.coordinates.length -1][0], this.coordinates[this.coordinates.length -1][1]);
        ctx.lineTo(this.x, this.y);
        ctx.strokeStyle = 'hsl(' + Math.random()*360 + ', 100%, ' + this.brightness + '%)';
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(this.tx, this.ty, this.targetRadius, 0, Math.PI * 2);
        ctx.stroke();
      }
    }

    class Particle {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.coordinates = [];
        this.coordinateCount = 5;
        while(this.coordinateCount--) {
          this.coordinates.push([this.x, this.y]);
        }
        this.angle = Math.random() * Math.PI * 2;
        this.speed = Math.random() * 5 + 1;
        this.friction = 0.95;
        this.gravity = 0.7;
        this.hue = Math.random() * 360;
        this.brightness = Math.random() * 50 + 50;
        this.alpha = 1;
        this.decay = Math.random() * 0.015 + 0.015;
      }
      update(index, particles) {
        this.coordinates.pop();
        this.coordinates.unshift([this.x, this.y]);
        this.speed *= this.friction;
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed + this.gravity;
        this.alpha -= this.decay;
        if(this.alpha <= 0) {
          particles.splice(index, 1);
        }
      }
      draw() {
        ctx.beginPath();
        ctx.moveTo(this.coordinates[this.coordinates.length -1][0], this.coordinates[this.coordinates.length -1][1]);
        ctx.lineTo(this.x, this.y);
        ctx.strokeStyle = 'hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
        ctx.stroke();
      }
    }

    let fireworks = [];
    let particles = [];
    let limiterTotal = 5;
    let limiterTick = 0;
    let timerTotal = 80;
    let timerTick = 0;
    let isRunning = false;

    function createParticles(x, y) {
      let particleCount = 30;
      while(particleCount--) {
        particles.push(new Particle(x, y));
      }
    }

    function loop() {
      if (!isRunning) return;
      requestAnimationFrame(loop);
      ctx.globalCompositeOperation = 'destination-out';
      ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
      ctx.fillRect(0, 0, cw, ch);
      ctx.globalCompositeOperation = 'lighter';

      let i = fireworks.length;
      while(i--) {
        fireworks[i].draw();
        fireworks[i].update(i, fireworks);
      }

      let j = particles.length;
      while(j--) {
        particles[j].draw();
        particles[j].update(j, particles);
      }

      if(timerTick >= timerTotal) {
        if(limiterTick >= limiterTotal) {
          const startX = cw/2;
          const startY = ch;
          const targetX = Math.random() * cw;
          const targetY = Math.random() * ch/2;
          fireworks.push(new Firework(startX, startY, targetX, targetY));
          limiterTick = 0;
        } else {
          limiterTick++;
        }
        timerTick = 0;
      } else {
        timerTick++;
      }
    }

    function showFireworks() {
      if (isRunning) return; // only start once
      isRunning = true;
      canvas.style.display = 'block';
      finalWish.style.display = 'block';
      loop();
    }

    function hideFireworks() {
      isRunning = false;
      canvas.style.display = 'none';
      finalWish.style.display = 'none';
      ctx.clearRect(0, 0, cw, ch);
    }

    const finalWish = document.getElementById('finalWish');
  </script>

</body>
</html>
